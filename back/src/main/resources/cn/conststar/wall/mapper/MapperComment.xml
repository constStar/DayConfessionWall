<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="cn.conststar.wall.mapper.MapperComment">

    <resultMap id="PojoCommentMap" type="PojoComment">
        <association property="userPublic" column="id" javaType="PojoUserPublic" select="getUser"/>
    </resultMap>

    <!--获取帖子分页评论列表-->
    <select id="getCommentsLimit" resultMap="PojoCommentMap">
        select *
        from `comment`
        where table_id = #{tableId}
        order by create_time DESC limit #{startIndex}, #{pageSize};
    </select>

    <!--获取帖子评论总数量-->
    <select id="getCount" parameterType="_int" resultType="_int">
        select count(1)
        from `comment`
        where table_id = #{tableId};
    </select>

    <!--添加帖子评论-->
    <insert id="addComment">
        insert into `comment` (table_id, user_id, name, anonymous, create_time, content, images)
            value (#{tableId},#{userId},#{name},#{anonymous},now(),#{content},#{images});
    </insert>

    <!--获取评论的用户信息-->
    <select id="getUser" resultType="PojoUserPublic">
        select `user`.*
        from `user`,
             `comment`
        where `comment`.user_id = `user`.id
          and `comment`.id = #{id}
          and `anonymous` = 0;
    </select>

</mapper>