(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-4275aa28"],{1022:function(e,t,a){"use strict";a("d853")},"6fb8":function(e,t,a){"use strict";a.r(t);a("386d");var n=function(){var e=this,t=e._self._c;return t("div",[t("el-card",{attrs:{shadow:"hover"}},[t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.comments,"row-class-name":e.tableRowClassName},on:{"sort-change":e.sortChange}},[t("el-table-column",{attrs:{sortable:"custom",prop:"id",width:"50"}}),t("el-table-column",{attrs:{sortable:"custom",prop:"tableId",label:"帖子id",width:"80"}}),t("el-table-column",{attrs:{sortable:"custom",prop:"userId",label:"用户id",width:"80"}}),t("el-table-column",{attrs:{prop:"userName",label:"用户名",width:"90"}}),t("el-table-column",{attrs:{sortable:"custom",prop:"content","show-overflow-tooltip":"",label:"内容",width:"300"}}),t("el-table-column",{attrs:{sortable:"custom",prop:"images","show-overflow-tooltip":"",label:"图片列表",width:"180"}}),t("el-table-column",{attrs:{sortable:"custom",prop:"createTime",label:"创建时间",width:"140"}}),t("el-table-column",{attrs:{sortable:"custom",prop:"stateName",label:"状态",width:"80"}}),t("el-table-column",{attrs:{width:"200"},scopedSlots:e._u([{key:"header",fn:function(a){return[t("el-input",{staticClass:"input-with-select",attrs:{size:"mini",placeholder:"请输入内容"},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search.apply(null,arguments)}},model:{value:e.keyword,callback:function(t){e.keyword=t},expression:"keyword"}},[e.isSearch?t("el-button",{attrs:{slot:"append",icon:"el-icon-close"},on:{click:e.clearSearch},slot:"append"}):e._e(),e.isSearch?e._e():t("el-button",{attrs:{slot:"append",icon:"el-icon-search"},on:{click:e.search},slot:"append"})],1)]}},{key:"default",fn:function(a){return[t("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.openDialogEdit(a.$index)}}},[e._v("编辑")]),1==a.row.state?t("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.reportSuccess(a.$index,a.row.id)}}},[e._v("通过审核")]):e._e()]}}])})],1),t("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{background:"",layout:"prev, pager, next","current-page":e.pageIndex,"page-size":e.pageSize,total:e.CommentCount},on:{"update:currentPage":function(t){e.pageIndex=t},"update:current-page":function(t){e.pageIndex=t},"current-change":e.setPage}})],1),t("el-dialog",{directives:[{name:"dialogDrag",rawName:"v-dialogDrag"}],attrs:{visible:e.dialogEditShow,title:"编辑用户信息",top:"7vh",center:"",width:"40%",fullscreen:e.isMobile},on:{"update:visible":function(t){e.dialogEditShow=t}}},[t("el-form",{ref:"formRef",attrs:{model:e.form}},[t("el-form-item",{attrs:{label:"id"}},[t("el-input",{attrs:{disabled:""},model:{value:e.form.id,callback:function(t){e.$set(e.form,"id",t)},expression:"form.id"}})],1),t("el-form-item",{attrs:{label:"内容"}},[t("el-input",{attrs:{type:"textarea",rows:5},model:{value:e.form.content,callback:function(t){e.$set(e.form,"content",t)},expression:"form.content"}})],1),t("el-form-item",{attrs:{label:"图片列表"}},[t("el-input",{attrs:{type:"textarea",rows:2},model:{value:e.form.images,callback:function(t){e.$set(e.form,"images",t)},expression:"form.images"}}),t("div",e._l(JSON.parse(null==e.form.images?"[]":e.form.images),(function(a,n){return t("el-image",{key:n,staticStyle:{width:"33%"},attrs:{src:e.IMAGE_URL+a}})})),1)],1),t("el-form-item",{attrs:{label:"状态"}},[t("el-select",{attrs:{placeholder:"帖子状态"},model:{value:e.form.state,callback:function(t){e.$set(e.form,"state",t)},expression:"form.state"}},[t("el-option",{attrs:{label:"正常",value:0}}),t("el-option",{attrs:{label:"待审核",value:1}}),t("el-option",{attrs:{label:"封禁",value:-1}})],1)],1)],1),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:e.closeDialogEdit}},[e._v("取 消")]),t("el-button",{attrs:{type:"primary"},on:{click:e.saveDialogEdit}},[e._v("保 存")])],1)],1)],1)},o=[],r=(a("7f7f"),a("456d"),a("ac6a"),a("db05")),s=a("942d"),i=a("403a"),m={name:"Comment",data:function(){return{IMAGE_URL:i["a"].image,comments:[],sortName:null,sortType:null,pageIndex:1,pageSize:10,CommentCount:0,keyword:"",isSearch:!1,dialogEditShow:!1,form:{},userInfMap:{}}},created:function(){this.getComments()},methods:{tableRowClassName:function(e){var t=e.row;e.rowIndex;return-1===t.state?"lock-row":1===t.state?"wait-row":""},sortChange:function(e){e.column;var t=e.order,a=e.prop;if(null==t)return this.sortName=null,void(this.sortType=null);"descending"==t?this.sortType=!1:"ascending"==t&&(this.sortType=!0),this.sortName="tableId"==a?"table_id":"userId"==a?"user_id":"createTime"==a?"create_time":"stateName"==a?"state":a,this.getComments()},reportSuccess:function(e,t){var a=this,n=this.comments[e];n.id!=t&&this.$message.error("非法操作"),r["a"].updateComment(n.id,n.content,n.images,0).finally((function(){a.getComment(e)}))},openDialogEdit:function(e){var t=this,a=this.comments[e];Object.keys(a).forEach((function(e){t.$set(t.form,e,a[e])})),this.$set(this.form,"index",e),this.dialogEditShow=!0},saveDialogEdit:function(){var e=this;r["a"].updateComment(this.form.id,this.form.content,this.form.images,this.form.state).then((function(t){e.getComment(e.form.index),e.closeDialogEdit(),e.$message.success(t.message)}))},closeDialogEdit:function(){this.dialogEditShow=!1},handleEdit:function(e){this.openDialog()},clearSearch:function(){this.pageIndex=1,this.keyword="",this.isSearch=!1,this.getComments()},search:function(){this.pageIndex=1,""==this.keyword?this.isSearch=!1:this.isSearch=!0,this.getComments()},setPage:function(e){this.getComments()},getUsersName:function(){for(var e=this,t=function(t){var a=e.comments[t].userId,n=e.userInfMap[a];if(null!=n)return e.$set(e.comments[t],"userName",n.name),"continue";s["a"].user(a).then((function(n){e.userInfMap[a]=n.data,e.$set(e.comments[t],"userName",n.data.name)}))},a=0;a<this.comments.length;a++)t(a)},getComment:function(e){var t=this;r["a"].comment(this.comments[e].id).then((function(a){t.$set(t.comments,e,a.data),t.getUsersName()}))},getComments:function(){var e=this;this.isSearch?(r["a"].searchCount(this.keyword).then((function(t){e.CommentCount=t.data})),r["a"].searchList(this.keyword,this.pageIndex,this.pageSize,this.sortName,this.sortType).then((function(t){e.comments=t.data,e.getUsersName()}))):(r["a"].count().then((function(t){e.CommentCount=t.data})),r["a"].pageList(this.pageIndex,this.pageSize,this.sortName,this.sortType).then((function(t){e.comments=t.data,e.getUsersName()})))}},computed:{isMobile:function(){return screen.width<=425}}},c=m,l=(a("1022"),a("2877")),u=Object(l["a"])(c,n,o,!1,null,null,null);t["default"]=u.exports},"942d":function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("b775"),o={pageList:function(e,t,a,o){return Object(n["a"])({url:"/api/admin/user/pageList",method:"get",params:{pageIndex:e,pageSize:t,rankName:a,rankType:o}})},count:function(){return Object(n["a"])({url:"/api/admin/user/count",method:"get"})},searchList:function(e,t,a,o,r){return Object(n["a"])({url:"/api/admin/user/searchList",method:"get",params:{keyword:e,pageIndex:t,pageSize:a,rankName:o,rankType:r}})},searchCount:function(e){return Object(n["a"])({url:"/api/admin/user/searchCount",method:"get",params:{keyword:e}})},user:function(e){return Object(n["a"])({url:"/api/admin/user/user",method:"get",params:{userId:e}})},getExamineCount:function(){return Object(n["a"])({url:"/api/admin/user/getExamineCount",method:"get"})},updateUser:function(e,t,a,o,r,s){return Object(n["a"])({url:"/api/admin/user/updateUser",method:"put",params:{userId:e,name:t,email:a,wechat:o,studentId:r,state:s}})},delete:function(e){return Object(n["a"])({url:"/api/admin/user/deleteUser",method:"delete",params:{userId:e}})}}},d853:function(e,t,a){},db05:function(e,t,a){"use strict";a.d(t,"a",(function(){return o}));var n=a("b775"),o={pageList:function(e,t,a,o){return Object(n["a"])({url:"/api/admin/comment/pageList",method:"get",params:{pageIndex:e,pageSize:t,rankName:a,rankType:o}})},count:function(){return Object(n["a"])({url:"/api/admin/comment/count",method:"get"})},searchList:function(e,t,a,o,r){return Object(n["a"])({url:"/api/admin/comment/searchList",method:"get",params:{keyword:e,pageIndex:t,pageSize:a,rankName:o,rankType:r}})},searchCount:function(e){return Object(n["a"])({url:"/api/admin/comment/searchCount",method:"get",params:{keyword:e}})},comment:function(e){return Object(n["a"])({url:"/api/admin/comment/comment",method:"get",params:{commentId:e}})},getExamineCount:function(){return Object(n["a"])({url:"/api/admin/comment/getExamineCount",method:"get"})},updateComment:function(e,t,a,o){return Object(n["a"])({url:"/api/admin/comment/updateComment",method:"put",params:{commentId:e,content:t,images:a,state:o}})},delete:function(e){return Object(n["a"])({url:"/api/admin/comment/deletecomment",method:"delete",params:{commentId:e}})}}}}]);